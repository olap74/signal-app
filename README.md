# Signal - Air Raid Alert

Ця програма розроблена для програвання звуків подій повітряних тривог. Вона використовує API сайта 
[Ukrainealarm](https://api.ukrainealarm.com/) та виводить звук події (тривога, відбій, ...) на дефолтний пристрій ПК.

## Налаштування

1. Скачайте [бінарний файл](https://github.com/olap74/signal-app/releases) для своєї операційної системи. Змініть імʼя файла для windows, додавши розширення `.exe`. Підтримується Windows x64, Linux x64 та MacOS aarch64 (Apple Silicon)
2. Створіть файл налаштувань `config.json`, або скачайте його з [репозиторія](https://github.com/olap74/signal-app/blob/main/config.json)
3. Пропишіть у файл налаштувань токен для авторизації Ukrainealarm. Токен можна отримати [відправивши запит](https://api.ukrainealarm.com/)
4. Налаштуйте (якщо потрібно) інші параметри, та запустіть програму.

### Опції файла `config.json`

- `api_url` - посилання API для отримання даних про тривоги у вашому регіоні. Має вигляд `https://api.ukrainealarm.com/api/v3/alerts/CODE`, де `CODE` треба замінити на код потрібного регіону. Повний список регіонів можна побачити за посиланням `https://api.ukrainealarm.com/api/v3/regions` (потрібна авторизація).
- `auth_header` - Заголовок авторизації. Має вигляд `Authorization: TOKEN`, де `TOKEN` треба замінити на токен який надають за запитом
- `audio_files` - містить посилання на аудіо файли різних типів тривог:
	- `AIR` - повітряна тривога
	- `ARTILLERY` - загроза артобстрілу
	- `URBAN_FIGHTS` - вуличні бої
	- `CHEMICAL` - хімічна загроза
	- `NUCLEAR` - ядерна загроза
	- `UNKNOWN` - невідомий тип тривоги
- `alert_on_empty` - звук, який виводиться по закінченню тривоги
- `debug` - Може бути `true` або `false`. `true` вмикає розширене логування
- `time_zone` - часова зона, для корекції часу
- `log_to_file` - Може бути `true` або `false`. `true` вмикає логування ще й у файл
- `log_file_path` - шлях та імʼя лог файла
- `repeat_audio_file` - сигнал коли тривога ще триває
- `repeat_interval_min` - час у хвилинах. Визначає кількість хвилин у часовому проміжку, через який буде виводитись сигнал що тривога ще триває
- `request_interval_sec` - секунди. Часовий проміжок для ріквестів до API

### Файл `state.json`

Cтворюється при першому запуску програми. Зберігає стан тривоги, щоб знати чи варто запускати тривогу. Якщо стан у файлі не відрізняється від стану, отриманого з сервера, звук тривоги не відтворюється. 

Дані у файлі мають вигляд:
```
{"active_alert_types":{"AIR":true},"last_update":"2025-01-01 00:10:11","last_played":null}
```
Це значить що триває тривога `AIR` з `2025-01-01 00:10:11`. Час з урахуванням часової зони. 

### Особливості
- Часові проміжки сигналу, що тривога ще триває `repeat_interval_min` відраховуються від початку тривоги і не має значення чи працювала програма, чи ні. Наприклад, якщо тривога почалася у 14:00 і тривала до 14:44, а ви зупинили програму о 14:17, та запустили знову о 14:28, сигнал що тривога триває пролунає о 14:15 та 14:30, якщо параметр `repeat_interval_min` встановлений на `15`.
- Шляхи до всіх файлів вказуються у Linux форматі, незалежно від системи, на якій ви запустили програму
- Програма не має опції виходу. Вихід з програми - `CTRL + c`

## Компіляція

Якщо ви щось змінили у файлі `main.go`, та хочете зібрати свою версію, вам потрібно встановити GoLang версії 1.23+

Далі скопіюйте програму на локальний диск, зайдіть у каталог програми, та запустіть:
```
go get -v ./...
go build -tags timetzdata
```
Це зробить бінарний файл для вашої системи. Тег `timetzdata` включає інформацію таймзон у бінарний файл. Для Linux та Mac зазвичай не потрібен.

## Підтримка

Програма написана "for fun", та підтримки не має. :) Але якщо є питання, звертайтесь.